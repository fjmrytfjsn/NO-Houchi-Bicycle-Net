# 基本設計仕様書

**プロジェクト:** NO-Houchi Bicycle Net
**バージョン:** 1.0

## 1. 概要・目的

大阪府北区における放置自転車問題を解決するためのシビックテック・プラットフォームの基本設計を記述する。
市民（サポーター）のスマートフォンとAI-OCR技術を活用し、放置自転車の早期発見・警告を行う。また、QRコードを用いた「タイムラグ解除機能」により、持ち主の確実な移動を促し、不正なタグ廃棄（逃げ得）をブラックリスト機能で防止する。

## 2. システム構成

本システムは以下の4コンポーネントで構成される。

- **サポーター用 Android アプリ**: 放置自転車の発見、OCRスキャン、ポイント管理を行う。
- **持ち主用 Web アプリ（QRアクセス）**: マーカーのQRからアクセスし、警告確認および解除申請（移動宣言）を行う。
- **管理者用ダッシュボード**: 北区役所・回収業者が使用。マップ表示、ブラックリスト管理、回収指示を行う。
- **バックエンド API サーバー**: データ処理、画像保存、外部OCR連携、ステータス管理を行う。

## 3. 機能要件（高レベル）

### サポーター機能

- **AI-OCR通報**: カメラで車体番号・防犯登録番号等を読み取り、位置情報と共に登録。
- **インセンティブ**: 情報量（OCR読取数）に応じたポイント付与、ランキング表示。

### 持ち主機能

- **警告確認**: QRコード読み取りで警告ステータスを表示。
- **タイムラグ解除（仮解除）**: Web上で移動申請を行う。即時解除はせず、一定時間（例:15分）経過後の移動確認をもって本解除とする。

### 管理者機能

- **放置マップ**: ヒートマップおよびピン表示による現状把握。
- **ブラックリスト管理**: 解除申請なく消失した自転車（ID特定済み）をリスト化。次回発見時に即時撤去アラートを出す。
- **回収指示**: 撤去対象リストの出力およびステータス更新。

## 4. 非機能要件

- **可用性**: 99.9% 目標（24時間稼働、深夜回収対応のため）。
- **レスポンス**: QR読み込みからWeb表示まで < 2秒（モバイル回線想定）。
- **セキュリティ**:
  - 全通信のHTTPS化。
  - サポーターの位置情報（行動履歴）は保持せず、通報地点のみ保存。
  - 画像データの非公開化（署名付きURLでのみ管理者へ表示）。
- **拡張性**: 将来的な他自治体展開を考慮したマイクロサービス構成（推奨）。

## 5. アーキテクチャ / 技術スタック

- **フロントエンド**:
  - App: Android (Kotlin)
  - Web: React / Next.js (SPA)
- **バックエンド**: Node.js (NestJS / Express)
- **データベース**:
  - RDB: PostgreSQL (ユーザー、マーカー、トランザクション管理)
  - NoSQL: Firestore (オプション: リアルタイム状態同期用)
- **ストレージ**: AWS S3 互換ストレージ (証拠写真保存)
- **外部サービス**: Azure Microsoft Foundry OCR API (文字認識)

## 6. データモデル（主要エンティティ）

- **Bicycle (放置自転車)**: ID, Status(警告中/仮解除/撤去対象), OCR_Data(車体番号等), Image_URL, Location
- **Supporter (サポーター)**: ID, Point, Rank
- **Blacklist (要注意リスト)**: ID, Feature_Vector, Past_Offenses

## 7. データフロー（運用シナリオ）

1.  **発見**: サポーターが自転車を撮影し、OCRで番号を読み取って送信。
2.  **警告**: サーバーがデータを登録し、ステータスを「警告中」にする。
3.  **分岐**:
    - **A (正規ルート)**: 持ち主がQRを読み、「移動申請」ボタンを押す。システムは「仮解除」モードへ移行。一定時間後に移動が確認されれば解決。
    - **B (不正ルート)**: 持ち主がタグを捨てて逃げる。後日、ブラックリスト照合により「逃走車」として登録される。
    - **C (放置継続)**: 持ち主が現れず、一定時間経過後に管理者が「回収指示」を出す。
4.  **解決**: 回収または移動完了により、ポイントが確定・付与される。

## 8. 運用・監視

- **ログ集約**: CloudWatch Logs / ELK Stack
- **アラート**:
  - システム異常（DB接続エラー等）
  - 業務アラート（ブラックリスト該当車両の検知時）

---

**更新履歴:**

- v1.0: D2班 中間発表フィードバック（OCR・タイムラグ機能・ブラックリスト）を反映
